{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LetsChat</title>
  
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
  <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="{%static 'css/emojionearea.min.css'%}">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="{%static 'js/emojionearea.min.js'%}"></script>
  <!-- <link rel="stylesheet" type="text/css" href="{%static 'css/lightSlider.css'%}">
  <script type="text/javascript" src="{%static 'js/lightSlider.js'%}"></script> -->

  
  <script>
    $(document).ready(function(){
      $(".hamburger").click(function(){
         $(".wrapper").toggleClass("collapse");
      });
    });

    // Check browser support
    if (typeof(Storage) !== "undefined") {
        // Store
        localStorage.setItem("loggedUserID", '{{userInfo.userId}}');
        localStorage.setItem("loggedUser", '{{userInfo.firstName}} {{userInfo.lastName}}');
        localStorage.setItem("loggedUserPic", '{{userInfo.profilePic.url}}');
        // Retrieve
        // document.getElementById("result").innerHTML = sessionStorage.getItem("lastname");
        // console.log(localStorage.getItem("loggedUserID"));
        // console.log(localStorage.getItem("loggedUser"));
        // console.log(localStorage.getItem("loggedUserPic"));
      } else {
        document.getElementById("result").innerHTML = "Sorry, your browser does not support Web Storage...";
      }
  </script>
</head>
<body id="body">
  {% for message in messages %}
  <strong>Message: </strong>{{ message }}
  {% endfor %}

<!--Search bar-->
<div id="myOverlay" class="overlay">
  <span class="closebtn" onclick="closeSearch()" title="Close Overlay">×</span>
  <div class="overlay-content">
    <form action="/search/" method="POST">{% csrf_token %}
      <input type="text" placeholder="Search.." name="search" id="searchBtnId">
      <button type="submit" id="searchBtnSubmitId"><i class="fa fa-search"></i></button>
    </form>
  </div>
</div>

<!--logOut Section-->
<div id="myOverlayLogOut" class="overlay">
  <span class="closebtn" onclick="closeLogOut()" title="Close Overlay">×</span>
  <div class="overlay-content-logOut">
    
    <div id="logOutDiv">
        <p><a href="/changepassword/" style="color: rgba(0, 150, 136, 1);"> Change Password</a></p>
      <br><hr>
      <p>Notifications</p><br><hr>
      <p onclick="Mode()" id="modeId">Night Mode</p><br><hr>
      <p ><a href="/logout/" style="color: rgba(0, 150, 136, 1);"> LogOut</a></p><br><hr>
      <p style="padding-bottom:2%;" onclick="closeLogOut()">Cancel</p>
    </div>
  </div>
</div>

<div class="wrapper">
  <div class="top_navbar">
    <div class="hamburger" id="hamBurgerId">
       <div class="one"></div>
       <div class="two"></div>
       <div class="three"></div>
    </div>
    <div class="top_menu" id="top_navbarId">
      <div class="logo">LetsChat</div>
      <ul>
        <li><form action="#" method="POST">{% csrf_token %}
          <a><i class="fas fa-search" class="openBtn" onclick="openSearch()" style="margin-top:8px;"></i>
          </form></a></li>
        <li id="noti_Container">
          <div id="noti_Counter"></div>   <!--SHOW NOTIFICATIONS COUNT.-->
                
                <!--A CIRCLE LIKE BUTTON TO DISPLAY NOTIFICATION DROPDOWN.-->
                <a id="noti_Button"><i class="fas fa-bell"></i></a>    

                <!--THE NOTIFICAIONS DROPDOWN BOX.-->
                <div id="notifications">
                    <h3 id="noti_heading">Notifications</h3><hr>
                    <div style="height:300px;"></div>
                    <div class="seeAll" id="seeAll" ><i >See All</i></div>
                </div>
          </li>
        <li><a href="#" onclick="openLogOut()">
          <i class="fas fa-user" class="openBtn" ></i>
          </a></li>
      </ul>
    </div>
  </div>
  
  <div class="sidebar" id="slidebarId">
      <ul>
          <li><a href="/profile/{{userInfo.userName}}">
          <span class="icon"><i class=""><img src="{{userInfo.profilePic.url}}" style="width:45px;height:45px;border-radius:50%;vertical-align:middle;"></i></span>
          <span class="title" style="font-weight:bold">
            <marquee direction="left" height="20" width="110" >{{userInfo.firstName}} {{userInfo.lastName}}</marquee>
          </span></a>
        </li>

        <li><a href="{%url 'friendSearch'%}">
          <span class="icon"><i class="fas fa-user-friends"></i></span>
          <span class="title">Friends</span></a></li>
        <li><a href="/album/">
          <span class="icon"><i class="fas fa-photo-video"></i></span>
          <span class="title">Photos</span>
          </a></li>
        <li><a href="/messages/">
          <span class="icon"><i class="far fa-comment-alt"></i></span>
          <span class="title">Messages</span>
          </a></li>
        <li><a href="/notifications/">
          <span class="icon"><i class="fas fa-bell"></i></span>
          <span class="title">Notification</span>
          </a></li>
        
    </ul>
  </div>
  
  <div class="main_container" id="PostContainerId">
    <div class="">
      
      <div id="PostAlert"><h4 style="color:rgba(0, 150, 136, 1);">{{flag}} <span style="float:right;"><i class="far fa-times-circle" onclick="PostAlertClose()"></i></span></h4></div>
      <form method="Post" action="{% url 'PostSubmission' %}" id="PostWrapper"  enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" value="{{userInfo.userId}}" id="currentUserId">
          <h4 style="padding:8px;">Create Post</h4>
          <textarea name="Post_Title" placeholder="what's on your mind?" style="width:90%;height:15vh;padding:2%;resize:none;" oninput="visibleButton()" id="TextPost"></textarea>
          <div id="PostOpt">
            <a href="#" class="icon"><i class="fas fa-map-marker-alt" id="Post_Icon_Cusomize"></i></a>
            <!-- <a href="#" class="icon"><i class="fas fa-photo-video" id="Post_Icon_Cusomize"> -->
              <label id="upfile1" style="cursor:pointer" class="fas fa-photo-video">
                <input type="file" name="MediaFile"  class="fas fa-photo-video" id="file1" style="display:none;">
              </label></i></a>
            <a href="#" class="icon"><i class="far fa-grin" id="Post_Icon_Cusomize" onclick="emojiCreater()"></i></a>
            <input type="submit" name="Post" id="SubmitPost" style="display:none;" value="Post">
          </div>
        </form>
      </div>
      <br><br>

      <!--Story-->
        <div style="background:rgba(191, 191, 191, 0.5);padding:2%;width:90%;" id="wrapperstorySectionId">
          <h4>Story</h4><br>

          <!--My Story-->
          <form action="#" method="POST">
              <input type="file" name="">
          </form>



          <!--Slider-->
          
          <ul id="autoWidth" class="cs-hidden">

        
            <li class="item-a trigger">
              
              <div class="storySection" style="">
                <div class="storyInnerSection">
                  <img src="{%static 'images/profile.jpeg'%}"  class="storyProfileSection">
                  <h4 style="text-align: left; color:white;">sarthak JAIN </h4>
                </div>

              </div>

            </li>

     
          </ul>


          <div class="modal" >
            
              <div class="modal-content">
                <span class="close-button">×</span>
                  
                      <div class="ModelstorySection" style="">
                        <br>
                       <p><img src="{%static 'images/profile.jpeg'%}"  style="width:55px;height:55px;border-radius:50%;padding:5px;border:2px solid rgba(0, 150, 136, 1);vertical-align: middle;

                       ">
                        <strong>sarthak JAIN</strong></p>
                        <br>
                        
                      
                      <div class="ModelstoryInnerSection"  style="
                      background:url('{%static 'images/landing-users.png'%}');background-repeat: no-repeat;background-size: cover;width:100%;height:100%;">
  
                        <div style="padding:2%;border-radius:5px;color:rgba(0, 150, 136, 1);">
                          <h3>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                          tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                          quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                          consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                          cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                          proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                          </h3>
                        </div>

                        <div style="position:fixed;bottom:5%;">
                          <input type="text" name="storyText" placeholder="Write Something" style="width:100%;padding:8px;border-radius:25px;border:2px solid rgba(0, 150, 136, 1);">
                        
                      </div>
                      </div>
                       

                      </div>
                      
                    
             
            </div>

            <script type="text/javascript">
              
              var modal = document.querySelector(".modal");
            </script>
        </div>
</div>
 


 <!--My Story Insert Model-->
  <div class="modal" >
            
              <div class="modal-content">
                <span class="close-button">×</span>
                  
                      <div class="ModelstorySection" style="">
                        
                        
                      
                      <div class="ModelstoryInnerSection" >
  
                        

                        <div style="position:fixed;bottom:5%;">
                          
                        
                      </div>
                      </div>
                      </div>          
            </div>

            <script type="text/javascript">
              
              var modal = document.querySelector(".modal");
            </script>
        </div>    
        <br><br>
      <div style="background:rgba(191, 191, 191, 0.5);padding:2%;width:90%;" id="postAllSectionId">

        

          <div>
              {% for data,data2,data4 in userData %}
            <img src="{{data.userPic}}" style="width:50px;height:50px;border-radius: 50%;vertical-align: middle;">
            <span style="font-weight:bold;padding-left:8px;">{{data.userName}}
            <div><span style="margin-left: 7%; font-size: 70%; margin-top: -10px;">
            <b>
                {% if data.date|date:"YmdHi" == date_now|date:"YmdHi" %}
                Just Now
                {% elif data.date|date:"Ymd" == date_now|date:"Ymd" %}
                {{ data.date|naturaltime }}
                {% else %}
                {{data.date|date:"M d"}} at {{data.date|date:"h:i A"}}
                {% endif %}
            </b></span></div></span><br>
            {% if data.Message %}
            {{data.Message}}
            <input type="hidden" value="{{data.postId}}" id="like">
            {% endif %}
            <br><br>
            {% if data.post %}
            <img src="{{data.post.url}}" style="max-width:100%;height:auto;">
            <br>
            {% endif %}
            
            <strong><p id="Counter{{data.postId}}" style="padding:8px 0px 0px 8px;">{{data2}} Likes</p></strong>
            
            <input type="hidden" value="{{data.postId}}" id="postLikeId">
            <input type="hidden" value="{{data.userId}}" id="postOwner">
            <input type="hidden" value="{{userInfo.userId}}" id="postLiker">

      			<a><i class="fas fa-thumbs-up PostResponseLike" id="{{data.postId}}" onclick="postLiker('{{data.postId}}','{{data.userId}}','{{userInfo.userId}}')" name="{{data.postId}}" style="color:{{data4}};" ></i></a>
      			<a href="#"><i class="far fa-comment-alt" id="PostResponseComment"></i></a>
            <hr>
            <span id="NewComment{{data.postId}}"></span>
            <br>
            <br>
            <form>
              <img src="{{userInfo.profilePic.url}}" style="width:50px;height:50px;border-radius:50%;vertical-align: middle;">
              <input type="text" placeholder="Drop your Comment" style="width:80%;padding:8px;" id="Comment{{data.postId}}">
              <input type="button" onclick="comments('{{data.postId}}','{{data.userId}}','{{userInfo.userId}}')" value="Comment" id="commentId">
            </form>
            <br><br>
            {% endfor %}
          </div>
      </div>
    </div>
    
  </div>
</div>
<script>
  function emojiCreater(){
    $("#TextPost").emojioneArea({
            pickerPosition: "bottom",
            tonesStyle: "bullet",
            
    });
    
document.getElementById("SubmitPost").style.display="block";

  }
  
// function likePost(data){
//   Id = data
//   $.ajax({
//     method:'POST',
//     url:'/postlike/',
//     data:{
//       postID : Id
//     },
//     success:function(e){
//       likeCount = e['Result']
//       document.getElementsByName(Id)[0].style.color=e['color'];
//       document.getElementById(Id).innerHTML=likeCount+" Likes";
//     },
//     error:function(data){
//       console.log('Failed');
//     }
//   })
// }



// //Automatically Check Like Request
// setInterval(function()
// {
// $.ajax({
//       method:'POST',
//       url:'/automaticallylike/',      
//       success:function(e){        
//         for(i=0;i<((e.like).length);i++){
//           document.getElementById(e.userData[i]).innerHTML=e.like[i]+" Likes";
//         }
//       },
//       error:function(data){
//         console.log('Failed');
//       }
//     });
// }, 5000); 

</script>
</body>

<script type="text/javascript" src="{%static 'js/script1.js'%}"></script>
<script type="text/javascript" src="{%static 'js/LikeSocket.js'%}"></script>
<script type="text/javascript" src="{%static 'js/RequestSocket.js'%}"></script>
<script type="text/javascript" src="{%static 'js/CommentSocket.js'%}"></script>

</html>